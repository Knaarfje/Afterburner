"use strict";"serviceWorker"in navigator&&navigator.serviceWorker.register("scripts/serviceworker.js");var app=angular.module("afterburnerApp",["firebase","ngTouch","ngRoute"]),templatePath="./Assets/dist/Templates";app.config(function($locationProvider,$routeProvider){var config={apiKey:"AIzaSyCIzyCEYRjS4ufhedxwB4vCC9la52GsrXM",authDomain:"project-7784811851232431954.firebaseapp.com",databaseURL:"https://project-7784811851232431954.firebaseio.com",storageBucket:"project-7784811851232431954.appspot.com"};firebase.initializeApp(config),$routeProvider.when("/signin",{template:"<signin></signin>"}).when("/",{resolve:{chart:function(SprintService){return SprintService.getOverviewChart()}},template:'\n                <app>\n                    <sprints title="\'Overview\'" \n                             back-title="\'Velocity\'" \n                             chart="$resolve.chart">\n                    </sprints> \n                </app>'}).when("/current-sprint",{resolve:{chart:function(SprintService){return SprintService.getCurrentChart()}},template:'\n                <app>\n                    <sprints title="$resolve.chart.name" \n                             back-title="\'Burndown\'" \n                             chart="$resolve.chart">\n                    </sprints>\n                </app>'}).when("/sprint/:sprint",{resolve:{chart:function(SprintService,$route){var sprint=$route.current.params.sprint;return SprintService.getSprintChart(sprint)}},template:'\n                <app>\n                    <sprints title="$resolve.chart.name" \n                             back-title="\'Burndown\'" \n                             chart="$resolve.chart">\n                    </sprints>\n                </app>'}).otherwise("/")}),particlesJS("particles-js",{particles:{number:{value:10,density:{enable:!0,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.1,random:!1,anim:{enable:!1,speed:1,opacity_min:.01,sync:!1}},size:{value:3,random:!0,anim:{enable:!1,speed:10,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.05,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:140,line_linked:{opacity:.1}},bubble:{distance:400,size:40,duration:5,opacity:.1,speed:300},repulse:{distance:200,duration:.4},push:{particles_nb:3},remove:{particles_nb:2}}},retina_detect:!0}),app.factory("SprintService",function($rootScope,$firebaseArray,$firebaseObject,UtilityService,$q,$filter,$location,$timeout){function getSprints(cb){var sprints=$firebaseArray(ref.child("sprints").orderByChild("order").limitToLast(15));sprints.$loaded(cb,function(){return $location.path("/signin")})}function getOverviewChart(){var deferred=$q.defer();return getSprints(function(sprints){var labels=sprints.map(function(d){return"Sprint "+_.pad(d.order)}),estimated=sprints.map(function(d){return d.velocity}),burned=sprints.map(function(d){var i=0;for(var x in d.burndown)i+=d.burndown[x];return i}),data=overviewData;data.labels=labels,data.datasets[1].data=burned,data.datasets[0].data=estimated;var current=sprints.$keyAt(sprints.length-1),currentSprint=$firebaseObject(ref.child("sprints/"+current));currentSprint.$loaded(function(sprint){console.log(sprint);var chartObj={type:"bar",options:chartOptions,data:data,velocity:sprint.velocity,burndown:_.sum(sprint.burndown),remaining:sprint.velocity-_.sum(sprint.burndown),needed:$filter("number")(sprint.velocity/sprint.duration,1)};deferred.resolve(chartObj)})}),deferred.promise}function buildBurnDownChart(sprint){var idealBurndown=burndownData.labels.map(function(d,i){return i===burndownData.labels.length-1?sprint.velocity:sprint.velocity/9*i}).reverse(),velocityRemaining=sprint.velocity,graphableBurndown=[];for(var x in sprint.burndown)velocityRemaining-=sprint.burndown[x],graphableBurndown.push(velocityRemaining);var data=burndownData;data.datasets[0].data=graphableBurndown,data.datasets[1].data=idealBurndown;var chartObj={type:"line",options:chartOptions,data:data,velocity:sprint.velocity,name:sprint.name,burndown:_.sum(sprint.burndown),remaining:sprint.velocity-_.sum(sprint.burndown),needed:$filter("number")(sprint.velocity/sprint.duration,1)};return chartObj}function getCurrentChart(){var deferred=$q.defer();return getSprints(function(sprints){var current=sprints.$keyAt(sprints.length-1),currentSprint=(current.split("s")[1],$firebaseObject(ref.child("sprints/"+current)));currentSprint.$watch(function(e){$rootScope.$broadcast("sprint:update"),deferred.resolve(buildBurnDownChart(currentSprint))})}),deferred.promise}function getSprintChart(sprintNumber){var deferred=$q.defer();return getSprints(function(sprints){var sprint=$firebaseObject(ref.child("sprints/s"+sprintNumber));sprint.$loaded(function(){deferred.resolve(buildBurnDownChart(sprint,sprintNumber))})}),deferred.promise}var _=UtilityService,ref=firebase.database().ref(),lineColor="#EB51D8",barColor="#5FFAFC",chartOptions={responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"single",cornerRadius:3},elements:{line:{fill:!1}},legend:{position:"bottom",labels:{fontColor:"#fff"}},scales:{xAxes:[{display:!0,gridLines:{display:!1,color:"rgba(255,255,255,.1)"},ticks:{fontColor:"#fff"}}],yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!0,color:"rgba(255,255,255,.1)",drawTicks:!1},labels:{show:!0}},{type:"linear",display:!1,position:"right",id:"y-axis-2",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!1},labels:{show:!1}}]}},overviewData={labels:[],datasets:[{type:"line",label:"Estimated",data:[],fill:!1,backgroundColor:lineColor,borderColor:lineColor,hoverBackgroundColor:"#5CE5E7",hoverBorderColor:"#5CE5E7",yAxisID:"y-axis-1"},{label:"Achieved",type:"bar",data:[],fill:!1,borderColor:barColor,backgroundColor:barColor,pointBorderColor:barColor,pointBackgroundColor:barColor,pointHoverBackgroundColor:barColor,pointHoverBorderColor:barColor,yAxisID:"y-axis-2"}]},burndownData={labels:["di","wo","do","vr","ma","di","wo","do","vr","ma"],datasets:[{label:"Gehaald",type:"line",data:[],fill:!1,yAxisID:"y-axis-2",borderColor:lineColor,backgroundColor:lineColor,pointBorderColor:lineColor,pointBackgroundColor:lineColor,pointHoverBackgroundColor:lineColor,pointHoverBorderColor:lineColor,hitRadius:15,lineTension:0},{type:"line",label:"Mean Burndown",data:[],fill:!1,yAxisID:"y-axis-1",borderColor:barColor,backgroundColor:barColor,pointBorderColor:barColor,pointBackgroundColor:barColor,pointHoverBackgroundColor:barColor,pointHoverBorderColor:barColor,hitRadius:15,lineTension:0}]};return{getSprints:getSprints,getOverviewChart:getOverviewChart,getCurrentChart:getCurrentChart,getSprintChart:getSprintChart}}),app.factory("UtilityService",function(){function pad(n){return n<10?"0"+n:n}function sum(items){var i=0;for(var x in items)i+=items[x];return i}return{pad:pad,sum:sum}}),app.component("app",{transclude:!0,controller:function($location,$firebaseAuth,SprintService){var ctrl=this,auth=$firebaseAuth();ctrl.auth=auth,auth.$getAuth()||$location.path("/signin"),ctrl.navOpen=!0,ctrl.signOut=function(){ctrl.auth.$signOut(),$location.path("/signin")}},templateUrl:templatePath+"/app.html"}),app.component("chart",{bindings:{options:"<",data:"<",loaded:"<",type:"<"},controller:function($element,$scope,$timeout,$location,$rootScope){function init(){ctrl.chart&&ctrl.chart.destroy(),ctrl.chart=new Chart($canvas,{type:ctrl.type,data:ctrl.data,options:ctrl.options}),window.chart=ctrl.chart,"/"===$location.path()&&($canvas.onclick=function(e){var activePoints=ctrl.chart.getElementsAtEvent(e);activePoints&&activePoints.length>1&&!function(){var clickedSprint=activePoints[1]._index+1;$timeout(function(){return $location.path("/sprint/"+clickedSprint)})}()})}var ctrl=this,$canvas=$element[0].querySelector("canvas");ctrl.chart,$scope.$watch(function(){return ctrl.loaded},function(loaded){loaded&&init()}),$rootScope.$on("sprint:update",function(){$timeout(function(){return ctrl.chart.update()})})},template:"<canvas></canvas>"}),app.component("footer",{bindings:{sprint:"<"},controller:function(){var ctrl=this;ctrl.statOpen=!1},templateUrl:templatePath+"/footer.html"}),app.component("signin",{controller:function($firebaseAuth,$location){var ctrl=this;ctrl.signIn=function(name,email){$firebaseAuth().$signInWithEmailAndPassword(name,email).then(function(data){$location.path("/")})}},templateUrl:templatePath+"/signin.html"}),app.component("sideNav",{bindings:{user:"<",open:"<",onSignOut:"&"},controller:function(){var ctrl=this;ctrl.open=!0},templateUrl:templatePath+"/sideNav.html"}),app.component("sprints",{bindings:{title:"<",backTitle:"<",chart:"<"},controller:function($firebaseAuth){var ctrl=this;$firebaseAuth();ctrl.loaded=!1,ctrl.$onInit=function(){return ctrl.loaded=!0}},templateUrl:templatePath+"/sprints.html"});