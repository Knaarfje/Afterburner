"use strict";function pad(n){return 10>n?"0"+n:n}var app=angular.module("afterburnerApp",["firebase"]);app.config(function(){var config={apiKey:"AIzaSyCIzyCEYRjS4ufhedxwB4vCC9la52GsrXM",authDomain:"project-7784811851232431954.firebaseapp.com",databaseURL:"https://project-7784811851232431954.firebaseio.com",storageBucket:"project-7784811851232431954.appspot.com"};firebase.initializeApp(config)}),app.controller("afterburnerCtrl",function($scope,$firebaseAuth,$firebaseObject,$firebaseArray,$timeout){var ref=firebase.database().ref();$timeout(function(){$scope.currentUser=firebase.auth().currentUser,$scope.init()},500),$scope.init=function(){$scope.currentUser&&$scope.initApp()},$scope.signin=function(email,password){$scope.authData=null,firebase.auth().signInWithEmailAndPassword(email,password).then(function(data){$scope.authData=data,$scope.currentUser=firebase.auth().currentUser,$scope.initApp()})},$scope.initApp=function(){$scope.initChart(),$scope.sprints=$firebaseArray(ref.child("sprints").orderByChild("order").limitToLast(15)),$scope.sprints.$watch(function(e){$scope.myBar&&"bar"==$scope.myBar.config.type&&$scope.updateChart()}),$scope.sprints.$loaded(function(e){var k=$scope.sprints.$keyAt($scope.sprints.length-1);$scope.lastSprint=$firebaseObject(ref.child("sprints/"+k))})},$scope.toOverview=function(){$scope.selectedSprint&&($scope.initChart(),$scope.updateChart(),$scope.selectedSprint.$destroy(),$scope.selectedSprint=null)},$scope.selectSprint=function(index){$scope.selectedSprint&&$scope.selectedSprint.$destroy();var k=$scope.sprints.$keyAt(index);$scope.selectedSprint=$firebaseObject(ref.child("sprints/"+k)),$scope.selectedSprint.$watch(function(e){$scope.myBar&&"line"==$scope.myBar.config.type&&$scope.updateBurndownChart($scope.selectedSprint)}),$scope.selectedSprint.$loaded().then(function(){$scope.initBurndownChart($scope.selectedSprint)})},document.getElementById("graph").onclick=function(evt){var activePoints=$scope.myBar.getElementsAtEvent(evt),index=activePoints[1]._index;$scope.selectSprint(index)},$scope.addBurndown=function(points,sprint){var sprintKey=$scope.sprints.$keyAt(sprint),burndowns=$scope.sprints.$getRecord(sprintKey).burndown;burndowns.$add(points)},$scope.initChart=function(){var chartCtx=document.getElementById("graph").getContext("2d");$scope.barChartData={labels:[],datasets:[{label:"Achieved",type:"line",data:[],fill:!1,borderColor:"#EB51D8",backgroundColor:"#EB51D8",pointBorderColor:"#EB51D8",pointBackgroundColor:"#EB51D8",pointHoverBackgroundColor:"#EB51D8",pointHoverBorderColor:"#EB51D8",yAxisID:"y-axis-2"},{type:"bar",label:"Estimated",data:[],fill:!1,backgroundColor:"#5FFAFC",borderColor:"#5FFAFC",hoverBackgroundColor:"#5CE5E7",hoverBorderColor:"#5CE5E7",yAxisID:"y-axis-1"}]},$scope.myBar&&$scope.myBar.destroy(),$scope.myBar=new Chart(chartCtx,{type:"bar",data:$scope.barChartData,options:{responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"label",cornerRadius:3},elements:{line:{fill:!1}},legend:{position:"bottom",labels:{fontColor:"#fff"}},scales:{xAxes:[{display:!0,gridLines:{display:!1,color:"rgba(255,255,255,.1)"},ticks:{fontColor:"#fff"}}],yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!0,color:"rgba(255,255,255,.1)",drawTicks:!1},labels:{show:!0}},{type:"linear",display:!1,position:"right",id:"y-axis-2",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!1},labels:{show:!1}}]}}})},$scope.updateChart=function(){var labels=$scope.sprints.map(function(d){return"Sprint "+pad(d.order)}),estimated=$scope.sprints.map(function(d){return d.velocity}),burned=$scope.sprints.map(function(d){var i=0;for(var x in d.burndown)i+=d.burndown[x];return i});$scope.myBar.data.labels=labels,$scope.myBar.data.datasets[0].data=burned,$scope.myBar.data.datasets[1].data=estimated,$scope.myBar.update()},$scope.initBurndownChart=function(sprint){var burndownData={labels:["di","wo","do","vr","ma","di","wo","do","vr"],datasets:[{label:"Gehaald",type:"line",data:[],fill:!1,yAxisID:"y-axis-2",borderColor:"#5FFAFC",backgroundColor:"#5FFAFC",pointBorderColor:"#5FFAFC",pointBackgroundColor:"#5FFAFC",pointHoverBackgroundColor:"#5FFAFC",pointHoverBorderColor:"#5FFAFC",lineTension:0},{type:"line",label:"Mean Burndown",data:[],fill:!1,yAxisID:"y-axis-1",borderColor:"#EB51D8",backgroundColor:"#EB51D8",pointBorderColor:"#EB51D8",pointBackgroundColor:"#EB51D8",pointHoverBackgroundColor:"#EB51D8",pointHoverBorderColor:"#EB51D8",lineTension:0}]},idealBurndown=burndownData.labels.map(function(d,i){return i==burndownData.labels.length-1?sprint.velocity:sprint.velocity/8*i}).reverse();burndownData.datasets[1].data=idealBurndown;var velocityRemaining=sprint.velocity,graphableBurndown=[];for(var x in sprint.burndown)velocityRemaining-=sprint.burndown[x],graphableBurndown.push(velocityRemaining);burndownData.datasets[1].data=idealBurndown,burndownData.datasets[0].data=graphableBurndown,$scope.myBar&&$scope.myBar.destroy(),$scope.myBar=new Chart(document.getElementById("graph").getContext("2d"),{type:"line",data:burndownData,options:{responsive:!0,maintainAspectRatio:!1,tooltips:{mode:"label",cornerRadius:3},elements:{line:{fill:!1}},legend:{position:"bottom",labels:{fontColor:"#fff"}},scales:{xAxes:[{display:!0,gridLines:{display:!1,color:"rgba(255,255,255,.1)"},ticks:{fontColor:"#fff"}}],yAxes:[{type:"linear",display:!0,position:"left",id:"y-axis-1",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!0,color:"rgba(255,255,255,.1)",drawTicks:!1},labels:{show:!0}},{type:"linear",display:!1,position:"right",id:"y-axis-2",ticks:{stepSize:10,beginAtZero:!0,fontColor:"#fff",suggestedMax:100},gridLines:{display:!1},labels:{show:!1}}]}}})},$scope.updateBurndownChart=function(sprint){var idealBurndown=$scope.myBar.data.labels.map(function(d,i){return i==$scope.myBar.data.labels.length-1?sprint.velocity:sprint.velocity/8*i}).reverse(),velocityRemaining=sprint.velocity,graphableBurndown=[];for(var x in sprint.burndown)velocityRemaining-=sprint.burndown[x],graphableBurndown.push(velocityRemaining);$scope.myBar.data.datasets[0].data=graphableBurndown,$scope.myBar.data.datasets[1].data=idealBurndown,$scope.myBar.update()},$scope.sum=function(items){var i=0;for(var x in items)i+=items[x];return i}}),particlesJS("particles-js",{particles:{number:{value:10,density:{enable:!0,value_area:800}},color:{value:"#ffffff"},shape:{type:"circle",stroke:{width:0,color:"#000000"},polygon:{nb_sides:5},image:{src:"img/github.svg",width:100,height:100}},opacity:{value:.1,random:!1,anim:{enable:!1,speed:1,opacity_min:.01,sync:!1}},size:{value:3,random:!0,anim:{enable:!1,speed:10,size_min:.1,sync:!1}},line_linked:{enable:!0,distance:150,color:"#ffffff",opacity:.05,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1,attract:{enable:!1,rotateX:600,rotateY:1200}}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"grab"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:140,line_linked:{opacity:.1}},bubble:{distance:400,size:40,duration:5,opacity:.1,speed:300},repulse:{distance:200,duration:.4},push:{particles_nb:3},remove:{particles_nb:2}}},retina_detect:!0});